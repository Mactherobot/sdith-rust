#[cfg(test)]
mod tests {
    use crate::{
        arith::{
            arrays::{Array2D, Array2DTrait},
            matrices::{gen_hmatrix, HPrimeMatrix},
        },
        constants::params::{PARAM_CHUNK_M, PARAM_CHUNK_W, PARAM_SPLITTING_FACTOR},
        spec_tests::{
            spec_constants::{SPEC_MAT_H, SPEC_SEED_H},
            SPEC_MASTER_SEED,
        },
        subroutines::prg::prg::PRG,
        witness::{compute_y, sample_witness, sample_x, PPoly, QPoly, SPoly},
    };

    #[test]
    fn test_h_matrix_gen_compare_to_spec() {
        let h_matrix: HPrimeMatrix = gen_hmatrix(&SPEC_SEED_H.to_vec());
        assert_eq!(h_matrix.data, SPEC_MAT_H);
    }

    #[test]
    fn test_compute_y() {
        let spec_s_b = vec![
            104u8, 196, 8, 103, 73, 229, 64, 230, 114, 214, 120, 227, 196, 165, 170, 187, 139, 13,
            78, 83, 73, 201, 218, 77, 219, 208, 90, 175, 213, 150, 66, 104, 28, 91, 57, 225, 51,
            23, 27, 53, 24, 159, 34, 144, 6, 226, 241, 142, 225, 86, 12, 114, 16, 140, 1, 175, 185,
            132, 159, 161, 198, 229, 230, 186, 84, 91, 50, 120, 254, 51, 76, 127, 42, 211, 190,
            239, 144, 112, 20, 194, 44, 65, 124, 253, 42, 184, 251, 26, 3, 37, 238, 53, 113, 130,
            1, 37, 242, 34, 133, 114, 87, 145, 115, 130, 158, 195, 151, 41, 169, 39, 100, 15, 213,
            48, 76, 241,
        ];
        let spec_s_a = vec![
            91u8, 53, 217, 202, 126, 3, 149, 65, 146, 123, 138, 232, 106, 201, 191, 25, 243, 241,
            209, 152, 211, 231, 185, 90, 175, 251, 122, 42, 110, 56, 1, 75, 56, 224, 253, 138, 252,
            154, 185, 33, 209, 25, 9, 53, 19, 122, 136, 239, 182, 204, 98, 77, 116, 61, 52, 30,
            133, 230, 25, 180, 121, 180, 19, 118, 175, 159, 14, 246, 149, 4, 163, 34, 192, 143, 73,
            80, 85, 169, 241, 40, 77, 238, 197, 237, 225, 137, 134, 44, 24, 48, 117, 201, 148, 153,
            159, 127, 126, 139, 225, 97, 10, 228, 123, 196, 96, 240, 49, 157, 83, 218, 30, 110,
            114, 135, 244, 49, 0, 43, 252, 110, 34, 146, 111, 32, 65, 151,
        ];

        let spec_y = vec![
            94u8, 199, 184, 194, 151, 197, 189, 96, 35, 216, 242, 229, 32, 70, 37, 206, 221, 89,
            225, 106, 198, 103, 215, 143, 82, 37, 155, 22, 54, 229, 214, 230, 15, 233, 227, 235,
            33, 16, 215, 198, 7, 3, 84, 235, 27, 233, 160, 125, 110, 95, 94, 241, 244, 164, 24,
            169, 46, 129, 1, 107, 218, 123, 145, 58, 92, 7, 217, 37, 18, 209, 241, 12, 114, 238,
            16, 75, 54, 209, 169, 146, 113, 207, 2, 214, 67, 194, 100, 82, 237, 91, 124, 97, 18,
            168, 157, 182, 146, 99, 19, 187, 117, 91, 49, 220, 126, 85, 168, 254, 228, 135, 5, 67,
            1, 137, 211, 237,
        ];

        let y = compute_y(
            &spec_s_b,
            &spec_s_a,
            &Array2D::from_bytes(128, 126, &SPEC_MAT_H),
        );

        assert_eq!(y, spec_y);
    }

    #[test]
    fn test_sample_x_compare_to_spec() {
        let spec_positions = [
            80u8, 29, 172, 114, 94, 50, 84, 16, 79, 159, 112, 3, 163, 6, 147, 170, 36, 91, 161,
            119, 139, 228, 24, 128, 136, 153, 169, 87, 64, 67, 143, 61, 167, 160, 218, 193, 78, 27,
            180, 205, 115, 39, 51, 240, 179, 210, 183, 133, 131, 127, 10, 0, 149, 130, 134, 85, 22,
            188, 232, 200, 151, 223, 93, 162, 178, 118, 7, 58, 144, 25, 213, 20, 141, 106, 207, 47,
            185, 109, 212, 132, 215, 231, 230, 135, 49, 108, 192,
        ];

        let spec_x_vectors = [
            91u8, 0, 0, 163, 0, 0, 254, 143, 0, 0, 252, 0, 0, 0, 0, 0, 94, 0, 0, 0, 249, 0, 103, 0,
            222, 73, 0, 69, 0, 241, 0, 0, 0, 0, 0, 0, 244, 0, 0, 76, 0, 0, 0, 0, 0, 0, 0, 234, 0,
            177, 90, 97, 0, 0, 0, 0, 0, 0, 97, 0, 0, 108, 0, 0, 141, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 3, 4, 65, 0, 0, 0, 92, 156, 0, 11, 0, 0, 0, 215, 0, 89, 158, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 21, 0, 177, 192, 0, 0, 15, 0, 254, 142, 0, 0, 116, 16, 0, 0, 0, 0, 0, 0,
            0, 142, 195, 0, 146, 211, 190, 13, 205, 77, 239, 0, 0, 199, 0, 60, 0, 149, 189, 0, 0,
            210, 0, 95, 0, 217, 0, 12, 0, 0, 0, 0, 0, 157, 79, 32, 104, 89, 0, 0, 0, 56, 0, 183,
            67, 0, 108, 0, 0, 0, 0, 0, 147, 113, 237, 0, 0, 9, 0, 20, 0, 0, 177, 0, 0, 0, 170, 253,
            0, 0, 0, 0, 0, 0, 205, 0, 0, 0, 0, 225, 0, 113, 0, 0, 26, 0, 121, 194, 0, 121, 0, 0,
            41, 0, 0, 0, 0, 26, 0, 0, 0, 0, 163, 0, 83, 125, 36, 0, 0, 0, 0, 0, 0, 0, 99, 0,
        ];

        let mut prg = PRG::init(&SPEC_MASTER_SEED, None);
        let (x_vectors, positions) = sample_x(&mut prg);

        assert_eq!(positions, spec_positions);
        assert_eq!(x_vectors, spec_x_vectors);
    }

    #[test]
    fn test_sample_witness_compare_to_spec() {
        let spec_s_poly: SPoly = Array2D::from_bytes(
            PARAM_CHUNK_M,
            PARAM_SPLITTING_FACTOR,
            &[
                91, 53, 217, 202, 126, 3, 149, 65, 146, 123, 138, 232, 106, 201, 191, 25, 243, 241,
                209, 152, 211, 231, 185, 90, 175, 251, 122, 42, 110, 56, 1, 75, 56, 224, 253, 138,
                252, 154, 185, 33, 209, 25, 9, 53, 19, 122, 136, 239, 182, 204, 98, 77, 116, 61,
                52, 30, 133, 230, 25, 180, 121, 180, 19, 118, 175, 159, 14, 246, 149, 4, 163, 34,
                192, 143, 73, 80, 85, 169, 241, 40, 77, 238, 197, 237, 225, 137, 134, 44, 24, 48,
                117, 201, 148, 153, 159, 127, 126, 139, 225, 97, 10, 228, 123, 196, 96, 240, 49,
                157, 83, 218, 30, 110, 114, 135, 244, 49, 0, 43, 252, 110, 34, 146, 111, 32, 65,
                151, 104, 196, 8, 103, 73, 229, 64, 230, 114, 214, 120, 227, 196, 165, 170, 187,
                139, 13, 78, 83, 73, 201, 218, 77, 219, 208, 90, 175, 213, 150, 66, 104, 28, 91,
                57, 225, 51, 23, 27, 53, 24, 159, 34, 144, 6, 226, 241, 142, 225, 86, 12, 114, 16,
                140, 1, 175, 185, 132, 159, 161, 198, 229, 230, 186, 84, 91, 50, 120, 254, 51, 76,
                127, 42, 211, 190, 239, 144, 112, 20, 194, 44, 65, 124, 253, 42, 184, 251, 26, 3,
                37, 238, 53, 113, 130, 1, 37, 242, 34, 133, 114, 87, 145, 115, 130, 158, 195, 151,
                41, 169, 39, 100, 15, 213, 48, 76, 241,
            ],
        );
        let spec_q_poly: QPoly = Array2D::from_bytes(
            PARAM_CHUNK_W,
            PARAM_SPLITTING_FACTOR,
            &[
                0, 187, 197, 184, 32, 206, 57, 42, 32, 37, 59, 37, 73, 179, 15, 43, 105, 228, 191,
                78, 179, 154, 225, 14, 158, 50, 71, 43, 47, 156, 136, 214, 59, 39, 254, 59, 62,
                147, 238, 67, 218, 170, 177, 117, 118, 179, 210, 138, 90, 43, 188, 214, 50, 195,
                144, 97, 17, 178, 126, 80, 168, 193, 121, 5, 87, 252, 64, 107, 200, 109, 83, 36,
                182, 206, 220, 57, 89, 121, 127, 54, 48, 244, 250, 205, 68, 142, 129,
            ],
        );
        let spec_p_poly: PPoly = Array2D::from_bytes(
            PARAM_CHUNK_W,
            PARAM_SPLITTING_FACTOR,
            &[
                21, 59, 220, 229, 93, 93, 142, 156, 72, 108, 14, 154, 237, 244, 236, 231, 193, 241,
                205, 36, 255, 58, 89, 151, 250, 221, 247, 221, 202, 116, 100, 158, 88, 50, 56, 19,
                5, 185, 223, 43, 121, 192, 58, 160, 180, 225, 193, 206, 177, 63, 10, 127, 105, 87,
                135, 210, 71, 200, 103, 141, 201, 111, 251, 66, 26, 52, 232, 34, 246, 250, 206, 33,
                82, 14, 32, 228, 204, 11, 176, 204, 203, 93, 242, 65, 74, 104, 241,
            ],
        );

        let mut prg = PRG::init(&SPEC_MASTER_SEED, None);

        let (q, s, p, ..) = sample_witness(&mut prg);

        assert_eq!(q, spec_q_poly, "q_poly does not match spec");
        assert_eq!(s, spec_s_poly, "s_poly does not match spec");
        assert_eq!(p, spec_p_poly, "p_poly does not match spec");
    }
}
